#
# Copyright (C) 2019 The Zap Kernel Project. All rights reserved.
#
# Zap-Kernel Configuration based on Synergy Tweaks by gj86
# Custom Kernel for Nougat AOSP based ROMs
# By: jprimero15 <jprimero155@gmail.com>
#
# This script is licensed under the terms of the GNU General Public 
# License version 2, as published by the Free Software Foundation, 
# and may be copied, distributed, and modified under those terms.
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#

on property:sys.boot_completed=1
  stop mpdecision

# IO Tweaks
  write /sys/block/mmcblk0/queue/iostats 0
  write /sys/block/mmcblk1/queue/iostats 0
  write /sys/block/mmcblk0/queue/rq_affinity 1
  write /sys/block/mmcblk1/queue/rq_affinity 1
  write /sys/block/mmcblk0/queue/add_random 0
  write /sys/block/mmcblk1/queue/add_random 0
  write /sys/block/mmcblk0/queue/scheduler fiops
  write /sys/block/mmcblk1/queue/scheduler fiops

# Disable Kernel Panic
  write /proc/sys/vm/panic_on_oom 0
  write /proc/sys/kernel/panic 0
  write /proc/sys/kernel/panic_on_oops 0

# Set CPU Min/Max Frequency
  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 268800
  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 2265600
  write /sys/devices/system/cpu/cpu1/cpufreq/scaling_min_freq 268800
  write /sys/devices/system/cpu/cpu1/cpufreq/scaling_max_freq 2265600
  write /sys/devices/system/cpu/cpu2/cpufreq/scaling_min_freq 268800
  write /sys/devices/system/cpu/cpu2/cpufreq/scaling_max_freq 2265600
  write /sys/devices/system/cpu/cpu3/cpufreq/scaling_min_freq 268800
  write /sys/devices/system/cpu/cpu3/cpufreq/scaling_max_freq 2265600

# Set CPU Governor
  # Interactive tweaks
  write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor interactive
  write /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor interactive
  write /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor interactive
  write /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor interactive
    
# Set GPU Governor tweaks
  write /sys/class/kgsl/kgsl-3d0/devfreq/governor msm-adreno-tz
  write /sys/class/kgsl/kgsl-3d0/devfreq/min_freq 100000000
  write /sys/class/kgsl/kgsl-3d0/devfreq/max_freq 600000000
  write /sys/class/kgsl/kgsl-3d0/max_gpuclk 450000000

# Set Adreno Idler
  write /sys/module/adreno_idler/parameters/adreno_idler_active Y
  write /sys/module/adreno_idler/parameters/adreno_idler_downdifferential 30
  write /sys/module/adreno_idler/parameters/adreno_idler_idlewait 15
  write /sys/module/adreno_idler/parameters/adreno_idler_idleworkload 10000

# Set Simple GPU Algorithm
  write /sys/module/simple_gpu_algorithm/parameters/simple_gpu_activate 0
  write /sys/module/simple_gpu_algorithm/parameters/simple_gpu_debug 0
  write /sys/module/simple_gpu_algorithm/parameters/simple_ramp_threshold 10000
  write /sys/module/simple_gpu_algorithm/parameters/simple_laziness 1

# Set Multi-Core Power Saving
  write /sys/devices/system/cpu/sched_mc_power_savings 1
  write /sys/module/workqueue/parameters/power_efficient Y

# Disable Cpu Boost
  write /sys/module/cpu_boost/parameters/cpuboost_enable N
	
# Set Default TCP Congestion
  chmod 777 /proc/sys/net/ipv4/tcp_congestion_control
  write /proc/sys/net/ipv4/tcp_congestion_control "westwood"
    
# Setup Hotplug
  write /sys/kernel/msm_mpdecision/conf/enabled 0

# AutoSMP Settings
  write /sys/kernel/autosmp/conf/min_boost_freq 268800
